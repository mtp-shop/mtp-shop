<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful | TPS TEMPLE</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,700;1,900&family=Poppins:wght@300;400;600&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --bg-dark: #050505;
            --glass-border: rgba(255, 255, 255, 0.15);
            --accent: #00ff88; /* Green for success */
            --accent-glow: rgba(0, 255, 136, 0.4);
            --text-main: #ffffff;
            --font-head: 'Montserrat', sans-serif;
            --font-body: 'Poppins', sans-serif;
            --font-tech: 'Space Mono', monospace; 
        }

        body {
            margin: 0; font-family: var(--font-body); color: var(--text-main);
            background-color: #050505;
            background-image: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.95)), url('background.png'); 
            background-size: cover; background-attachment: fixed; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .success-container {
            max-width: 600px; width: 90%;
            background: rgba(5, 5, 5, 0.6); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 40px; text-align: center;
            box-shadow: 0 0 50px rgba(0,255,136,0.1);
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn { 0% { opacity:0; transform: scale(0.8); } 100% { opacity:1; transform: scale(1); } }

        .icon-circle {
            width: 100px; height: 100px; background: rgba(0,255,136,0.1);
            border: 2px solid var(--accent); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            margin: 0 auto 30px; box-shadow: 0 0 30px var(--accent-glow);
        }
        .icon-circle i { font-size: 3rem; color: var(--accent); }

        h1 {
            font-family: var(--font-head); font-weight: 900; font-style: italic;
            font-size: 2.5rem; margin: 0 0 10px 0; text-transform: uppercase;
            background: linear-gradient(to right, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        p { color: #aaa; margin-bottom: 30px; line-height: 1.6; }
        
        .order-summary {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; padding: 20px; margin-bottom: 30px; text-align: left;
        }
        
        .summary-title { font-family: var(--font-tech); color: #888; font-size: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        
        .order-item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
        .item-name { font-weight: 700; color: white; }
        .item-price { font-family: var(--font-tech); color: var(--accent); }

        .total-row { border-top: 1px dashed rgba(255,255,255,0.2); margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between; font-weight: 900; font-family: var(--font-head); font-style: italic; font-size: 1.1rem; }

        .action-btn {
            display: inline-block; padding: 15px 40px;
            background: var(--accent); color: black;
            font-family: var(--font-head); font-weight: 900; font-style: italic;
            text-decoration: none; border-radius: 50px;
            transition: 0.3s; box-shadow: 0 0 20px var(--accent-glow);
        }
        .action-btn:hover { transform: translateY(-5px); box-shadow: 0 10px 40px var(--accent-glow); background: white; }

        .discord-note { margin-top: 20px; font-size: 0.8rem; color: #666; }
        .discord-note i { color: #5865F2; }
    </style>
</head>
<body>

    <div class="success-container">
        <div class="icon-circle"><i class="fas fa-check"></i></div>
        <h1>Payment Confirmed</h1>
        <p>Thank you for your purchase. Please Open a Ticket To Continue.</p>

        <div class="order-summary" id="orderSummary">
            <div class="summary-title"><span>ORDER SUMMARY</span> <span id="orderDate"></span></div>
            <div id="itemsList">
                <!-- Items injected via JS -->
            </div>
            <div class="total-row">
                <span>TOTAL PAID</span>
                <span id="orderTotal" style="color:var(--accent)">Â£0.00</span>
            </div>
        </div>

        <a href="https://discord.gg/Vc7fjmbXAe" target="_blank" class="action-btn">OPEN TICKET (DISCORD)</a>
        <div class="discord-note"><i class="fab fa-discord"></i> Please open a ticket to claim your assets.</div>
        <br>
        <a href="index.html" style="color: #666; text-decoration: none; font-size: 0.9rem;">Return to Shop</a>
    </div>

    <script>
        // Retrieve the temporary order object { items: [], total: "...", date: "..." }
        const pendingOrder = JSON.parse(localStorage.getItem('mtpPendingOrder'));
        const itemsList = document.getElementById('itemsList');
        const orderTotalEl = document.getElementById('orderTotal');
        const orderDateEl = document.getElementById('orderDate');

        if (pendingOrder && pendingOrder.items) {
            // 1. Display Order Details
            orderTotalEl.innerText = pendingOrder.total;
            orderDateEl.innerText = pendingOrder.date;

            pendingOrder.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'order-item';
                div.innerHTML = `
                    <span class="item-name">${item.qty}x ${item.title}</span>
                    <span class="item-price">${item.price}</span>
                `;
                itemsList.appendChild(div);
            });

            // 2. Save Order to User History (Database Simulation)
            const currentUser = JSON.parse(localStorage.getItem('tps_current_user'));
            
            if (currentUser) {
                const usersDB = JSON.parse(localStorage.getItem('tps_users_db')) || [];
                const userIndex = usersDB.findIndex(u => u.email === currentUser.email);
                
                if (userIndex > -1) {
                    const newOrder = {
                        id: Math.floor(Math.random() * 90000) + 10000,
                        date: pendingOrder.date || new Date().toLocaleDateString(),
                        count: pendingOrder.items.length,
                        total: pendingOrder.total,
                        items: pendingOrder.items // Save detailed items
                    };
                    
                    // Add to History (Top of list)
                    usersDB[userIndex].orders.unshift(newOrder);
                    currentUser.orders.unshift(newOrder);
                    
                    // Save back to LocalStorage
                    localStorage.setItem('tps_users_db', JSON.stringify(usersDB));
                    localStorage.setItem('tps_current_user', JSON.stringify(currentUser));
                }
            }
            
            // 3. Clear Cart & Pending Order (Prevent duplicates on refresh)
            localStorage.removeItem('mtpCart');
            localStorage.removeItem('mtpPendingOrder');

        } else {
            // Fallback if accessed directly without an order
            document.querySelector('.order-summary').style.display = 'none';
            document.querySelector('p').innerText = "Session expired or order already processed.";
        }
    </script>
</body>
</html>
